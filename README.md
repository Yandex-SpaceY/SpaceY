# SpaceY

Командная практическая работа Яндекс.Практики курса мидл фронтенд-разработчика:
https://praktikum.yandex.ru/middle-frontend/
--------------------------------------------

### Описание проекта

#### Игра

**SpaceY** - добро пожаловать в мир ~~прекрасного~~ будущего. Вы пилот космического коробля, который нелегально использует еще не до конца построенную межпланетную трассу-ускоритель для перевоза пассажиров и грузов. Трасса полна опасностей и ваш путь может в любой момент закончиться катастрофой. Ваша цель - пролететь как можно дальше, оставшись целым.

- Жанр игры - бесконечный раннер *(to the death)*.
- Визуальный стиль - пиксель-арт *(какой уж есть)*.
- Аудио стиль - retro wave *(все по канонам жанра)*.
- Управление - одна большая кнопка *(ну или тап на экране... один)*.

![preview](src/assets/images/preview.png)

#### Стек

![html@5](https://img.shields.io/badge/html-5-E34F26?style=for-the-badge&logo=html5) ![sass@1.3](https://img.shields.io/badge/sass-1.3-CC6699?style=for-the-badge&logo=sass) ![node.js@12](https://img.shields.io/badge/node.js-12-339933?style=for-the-badge&logo=nodedotjs) ![typescript@4](https://img.shields.io/badge/typescript-4-3178C6?style=for-the-badge&logo=typescript) ![reactjs@17](https://img.shields.io/badge/Reactjs-17-61DAFB?style=for-the-badge&logo=react) ![webpack@5](https://img.shields.io/badge/webpack-5-8dd6f9?style=for-the-badge&logo=webpack)

#### CI/CD

![github@deploy](https://img.shields.io/github/workflow/status/Yandex-SpaceY/SpaceY/Deploy?style=for-the-badge&logo=github&label=deploy)

---

### Установка и настройка

Перед первым запуском установите стабильные версии всех пакетов:

- `npm ci` — установка стабильной версии.

Сборка Docker образов включает в себя три контейнера:

- `space-y-server` - непосредственно само приложение с SSH сервером на базе `express`
- `postgres` - база данных для хранения пользовательских настроек и форума
- `nginx` - proxy-сервер для express-сервера с настройками сжатия, логирования, CSP, SSL и т.п.

#### Локальная установка

##### 1. Скопируйте `.env.example` в `.env`

Приложению необходимо указать переменные среды для запуска. Для локальной разработки необходимо создать `.env` файл в той же директории, что и данный файл (`README.md`). Docker-compose автоматически заберет указанные переменные из `.env` файла.
Значения переменных можете забрать из `.env.example` или ввести свои

```cp .env.example .env```

Файл `.env` по умолчанию игнорируется git.

##### 2. Запустите докер контейнер

```docker-compose up```

Порты образов по умолчанию:

- `express: 5000`
- `postgres: 54322`
- `nginx: 3050` (proxy для express)

##### 3. Режим разработки

Для режима разработки необходим запущенный контейнер `postgres` для корректной работы с базой данных. Остальные контейнеры не обязательны к запуску.

- `npm start` — запуск версии для разработчика, порт: 3000.
- `npm run build` — сборка стабильной версии.
- `npm run lint` — проверка линтеров.
- `npm run watch:start` - сборка и запуск сервера с отслеживанием изменений

#### Деплой в облако

По умолчанию GitHub Actions настроены на сборку контейнера приложения и отправку его в Docker Hub с последующим запуском `docker-compose` в облаке, который вытягивает все необходимые образы (включая postgres и nginx) из хаба. Тег docker-хаба по умолчанию для приложения - `supergrovernn/spacey`.

Для корректной работы в облаке с использованием своего аккаунта в docker должны быть произведены следующие действия:

- Локально:
  - создайте в рабочей папке файл `.env` и скопируйте в него содержимое файла `example.env`
  - измените в нем конфиденциальные данные - имя пользователя и пароль
  - `docker build -t <тег docker-хаба> .` - сборка образа приложения для хаба (точка в конце обязательна)
  - `docker push <тег docker-хаба>` - отправка образа в хаб


- На сервере облака
  - создайте в рабочей папке облака файл `docker-compose.yaml` и скопируйте в него содержимое файла `docker-compose-cloud.yaml` из репозитория
  - измените в файле `docker-compose.yaml` облака имя тега docker-хаба на необходимый
  - создайте в рабочей папке облака папку `nginx`
  - создайте в ней файл `default.conf` и скопируйте в него содержимое файла `default-cloud.conf` из репозитория
  - скопируйте в эту же папку созданные вами SSL ключи со следующими названиями файлов: `cert.pem` - файл сертификата, `key.pem` - файл публичного ключа
  - создайте в рабочей папке файл `.env` и скопируйте в него содержимое файла `.env`, который вы создали ранее локально
  - `sudo docker pull <тег docker-хаба>:latest` - получите образы из хаба
  - `sudo docker-compose up -d --no-deps` - запуск образов

Нужно учитывать, что приложение завязано на использовании API от домена `ya-praktikum.tech` и пользователь получает `cookies` именно от этого домена, поэтому наиболее корректная работа авторизации и SSR "внутренних" страниц будет происходить на сервере, который расположен в поддомене `ya-praktikum.tech`.

---

### Прогресс

#### Спринт 9

- Добавлены CSP, защита от XSS
- Добавлен nginx сервер с плюшками для проксирования Express сервера
- Сконфигурировано облако в Yandex Cloud
- Настроен автоматический деплой в облако с помощью GitHub Actions (CI/CD)
- Настроены SSL, HTTPS, HTTP/2
- В игру добавлены уровни сложности
- Создан дизайн альтернативной темы
- Проведен рефакторинг всех стилей приложения с исправлением ошибок и адаптацией под различные экраны

#### Спринт 8

- Подключен PostgreSQL для форума и хранения настроек пользователя
- Добавлен полнофункциональный форум
- Добавлен механизм темизация
- Настроен webpack hash
- Проведен рефакторинг компонента игрового меню с помощью добавления компонента элемента меню
- Развитие игры ("аптечки", ускорение со временем, несколько типов препятствий, адаптация под разные размеры экранов и т.п.)
- В игру добавлен тап для мобильных устройств

#### Спринт 7

- Настроен SSR на базе Express сервера с Redux и Router
- Добавлена OAuth-авторизация
- Добавлены API и функциональность таблицы лидеров
- Развитие игрового движка
- В игру добавлено Vibration API

#### Спринт 6

- Добавлен Redux
- Настроен Service Worker
- Подключен Подключить Formik + Yup
- Добавлены тесты и настроен prepush
- Применены API ручки для работы с профилем и авторизации (ручкам прикрутили ножки)
- Сделана авторизация через HOC
- Реализована первая версия игрового движка на TypeScript с декомпозиционной структурой
- В игру добавлен звук
- Добавлен компонент GameOver со всем необходимым функционалом
- Добавлен компонент игрового меню с динамическим контентом и экшенами
- Автоматическая пауза игры при потере фокуса

#### Спринт 5

- Настроено окружение в первом боевом приближении (webpack, eslint, stylelint, typescript, server, huscky, heroku)
- Созданы макеты ([проект в Figma](https://www.figma.com/file/uvThBv2cRZ8VvPoJb9CDWW/SpaceY?node-id=20%3A164&viewport=387%2C-1234%2C0.4691857099533081))
- Добавлен и настроен React Router
- Добавлен и настроен React Error Boundary
- По макетам сверстаны основные страницы
- Созданы и прикручены API ручки (пока без ножек)
- Создан рабочий прототип игры с помощью Canvas API
- Игра интегрирована в react компонент и может передавать web-приложению статусы паузы и окончания игры, кол-во урона и набранных очков.

---

## Команда

# Антананариву

*(для уверенного произношения названия команды рекомендуется прочитать его несколько раз подряд в быстром темпе, а так же заглянуть в Викиторию)*

**Студенты**

[![](https://github.com/ValeriaKoliagina.png?size=50)](https://github.com/ValeriaKoliagina) [![](https://github.com/SupergroverNN.png?size=50)](https://github.com/SupergroverNN) [![](https://github.com/StopNGo.png?size=50)](https://github.com/StopNGo)

**Наставник**

[![](https://github.com/kotosha-real.png?size=50)](https://github.com/kotosha-real)

